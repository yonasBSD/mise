#!/usr/bin/env bash

# Test that lockfile is respected when using version aliases
# https://github.com/jdx/mise/discussions/8175

export MISE_LOCKFILE=1

cat <<EOF >mise.toml
[tools]
tiny = "myalias"

[tool_alias.tiny.versions]
myalias = "2"

[settings]
lockfile = true
EOF

cat <<EOF >mise.lock
[[tools.tiny]]
version = "2.0.0"
EOF

rm -rf "$MISE_DATA_DIR/installs/tiny"
mise install
assert "mise ls tiny --json --current | jq -r '.[0].requested_version'" "myalias"
assert "mise ls tiny --json --current | jq -r '.[0].version'" "2.0.0"
